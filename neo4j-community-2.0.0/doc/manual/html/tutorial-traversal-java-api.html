<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>33.2. Traversal Framework Java API</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="The Neo4j Manual v2.0.0" /><link rel="up" href="tutorial-traversal.html" title="Chapter 33. The Traversal Framework" /><link rel="prev" href="tutorial-traversal-concepts.html" title="33.1. Main concepts" /><link rel="next" href="indexing.html" title="Chapter 34. Legacy Indexing" /><link rel="preface" href="preface.html" title="Preface" /><link rel="part" href="introduction.html" title="Part I. Introduction" /><link rel="chapter" href="introduction-highlights.html" title="Chapter 1. Neo4j Highlights" /><link rel="chapter" href="graphdb-concepts.html" title="Chapter 2. Graph Database Concepts" /><link rel="chapter" href="graphdb-neo4j.html" title="Chapter 3. The Neo4j Graph Database" /><link rel="part" href="tutorials.html" title="Part II. Tutorials" /><link rel="chapter" href="tutorials-cypher.html" title="Chapter 4. Getting started with Cypher" /><link rel="chapter" href="data-modeling-examples.html" title="Chapter 5. Data Modeling Examples" /><link rel="chapter" href="languages.html" title="Chapter 6. Languages" /><link rel="part" href="cypher-query-lang.html" title="Part III. Cypher Query Language" /><link rel="chapter" href="cypher-intro.html" title="Chapter 7. Introduction" /><link rel="chapter" href="query-syntax.html" title="Chapter 8. Syntax" /><link rel="chapter" href="query-general.html" title="Chapter 9. General Clauses" /><link rel="chapter" href="query-read.html" title="Chapter 10. Reading Clauses" /><link rel="chapter" href="query-write.html" title="Chapter 11. Writing Clauses" /><link rel="chapter" href="query-function.html" title="Chapter 12. Functions" /><link rel="chapter" href="cypher-schema.html" title="Chapter 13. Schema" /><link rel="chapter" href="examples-from-sql-to-cypher.html" title="Chapter 14. From SQL to Cypher" /><link rel="part" href="reference-documentation.html" title="Part IV. Reference" /><link rel="chapter" href="capabilities.html" title="Chapter 15. Capabilities" /><link rel="chapter" href="transactions.html" title="Chapter 16. Transaction Management" /><link rel="chapter" href="import.html" title="Chapter 17. Data Import" /><link rel="chapter" href="graph-algo.html" title="Chapter 18. Graph Algorithms" /><link rel="chapter" href="rest-api.html" title="Chapter 19. REST API" /><link rel="chapter" href="deprecations.html" title="Chapter 20. Deprecations" /><link rel="part" href="operations.html" title="Part V. Operations" /><link rel="chapter" href="deployment.html" title="Chapter 21. Installation &amp; Deployment" /><link rel="chapter" href="embedded-configuration.html" title="Chapter 22. Configuration &amp; Performance" /><link rel="chapter" href="ha.html" title="Chapter 23. High Availability" /><link rel="chapter" href="operations-backup.html" title="Chapter 24. Backup" /><link rel="chapter" href="operations-security.html" title="Chapter 25. Security" /><link rel="chapter" href="operations-monitoring.html" title="Chapter 26. Monitoring" /><link rel="part" href="tools.html" title="Part VI. Tools" /><link rel="chapter" href="tools-webadmin.html" title="Chapter 27. Web Interface" /><link rel="chapter" href="shell.html" title="Chapter 28. Neo4j Shell" /><link rel="part" href="community.html" title="Part VII. Community" /><link rel="chapter" href="community-support.html" title="Chapter 29. Community Support" /><link rel="chapter" href="community-contributing.html" title="Chapter 30. Contributing to Neo4j" /><link rel="part" href="advanced-usage.html" title="Part VIII. Advanced Usage" /><link rel="chapter" href="server-extending.html" title="Chapter 31. Extending the Neo4j Server" /><link rel="chapter" href="tutorials-java-embedded.html" title="Chapter 32. Using Neo4j embedded in Java applications" /><link rel="chapter" href="tutorial-traversal.html" title="Chapter 33. The Traversal Framework" /><link rel="chapter" href="indexing.html" title="Chapter 34. Legacy Indexing" /><link rel="chapter" href="batchinsert.html" title="Chapter 35. Batch Insertion" /><link rel="appendix" href="manpages.html" title="Appendix A. Manpages" /><link rel="refentry" href="re01.html" title="neo4j" /><link rel="refentry" href="re02.html" title="neo4j-installer" /><link rel="refentry" href="re03.html" title="neo4j-shell" /><link rel="refentry" href="re04.html" title="neo4j-backup" /><link rel="refentry" href="re05.html" title="neo4j-arbiter" /><link rel="subsection" href="tutorial-traversal-java-api.html#_traversaldescription" title="33.2.1. TraversalDescription" /><link rel="subsection" href="tutorial-traversal-java-api.html#_evaluator" title="33.2.2. Evaluator" /><link rel="subsection" href="tutorial-traversal-java-api.html#_traverser" title="33.2.3. Traverser" /><link rel="subsection" href="tutorial-traversal-java-api.html#_uniqueness" title="33.2.4. Uniqueness" /><link rel="subsection" href="tutorial-traversal-java-api.html#_order_8201_8212_8201_how_to_move_through_branches" title="33.2.5. Order — How to move through branches?" /><link rel="subsection" href="tutorial-traversal-java-api.html#_branchselector" title="33.2.6. BranchSelector" /><link rel="subsection" href="tutorial-traversal-java-api.html#_path" title="33.2.7. Path" /><link rel="subsection" href="tutorial-traversal-java-api.html#_pathexpander_relationshipexpander" title="33.2.8. PathExpander/RelationshipExpander" /><link rel="subsection" href="tutorial-traversal-java-api.html#_expander" title="33.2.9. Expander" /><link rel="subsection" href="tutorial-traversal-java-api.html#examples-how-to-use-the-traversal-framework" title="33.2.10. How to use the Traversal framework" /><link rel="copyright" href="ln-idp218960.html" title="License: Creative Commons 3.0" />


<!-- favicon -->

<link rel="shortcut icon" href="http://neo4j.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://neo4j.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/neo.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushCypher.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushProperties.js"></script>

<!-- activate when needed
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
-->
 
<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Replace SVG for browsers that lack support. -->
<script type="text/javascript" src="js/svgreplacer.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Version -->

<script type="text/javascript" src="js/version.js"></script>

<!-- Offline Sidebar -->

<script type="text/javascript" src="js/sidebar.js"></script>


<div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">The Neo4j Manual</a></span> &gt; <span class="breadcrumb-link"><a href="advanced-usage.html">Advanced Usage</a></span> &gt; <span class="breadcrumb-link"><a href="tutorial-traversal.html">The Traversal Framework</a></span> &gt; <span class="breadcrumb-node">Traversal Framework Java API</span></div></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="tutorial-traversal-concepts.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="indexing.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="tutorial-traversal-java-api"></a>33.2. Traversal Framework Java API</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="tutorial-traversal-java-api.html#_traversaldescription">33.2.1. TraversalDescription</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_evaluator">33.2.2. Evaluator</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_traverser">33.2.3. Traverser</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_uniqueness">33.2.4. Uniqueness</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_order_8201_8212_8201_how_to_move_through_branches">33.2.5. Order — How to move through branches?</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_branchselector">33.2.6. BranchSelector</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_path">33.2.7. Path</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_pathexpander_relationshipexpander">33.2.8. PathExpander/RelationshipExpander</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#_expander">33.2.9. Expander</a></span></dt><dt><span class="section"><a href="tutorial-traversal-java-api.html#examples-how-to-use-the-traversal-framework">33.2.10. How to use the Traversal framework</a></span></dt></dl></div><p>The traversal framework consists of a few main interfaces in addition to <code class="literal">Node</code> and <code class="literal">Relationship</code>: <code class="literal">TraversalDescription</code>, <code class="literal">Evaluator</code>, <code class="literal">Traverser</code> and <code class="literal">Uniqueness</code> are the main ones.
The <code class="literal">Path</code> interface also has a special purpose in traversals, since it is used to represent a position in the graph when evaluating that position.
Furthermore the <code class="literal">PathExpander</code> (replacing <code class="literal">RelationshipExpander</code>) and <code class="literal">Expander</code> interfaces are central to traversals, but users of the API rarely need to implement them.
There are also a set of interfaces for advanced use, when explicit control over the traversal order is required: <code class="literal">BranchSelector</code>, <code class="literal">BranchOrderingPolicy</code> and <code class="literal">TraversalBranch</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_traversaldescription"></a>33.2.1. TraversalDescription</h3></div></div></div><p>The <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html" target="_top"><code class="literal">TraversalDescription</code></a> is the main interface used for defining and initializing traversals.
It is not meant to be implemented by users of the traversal framework, but rather to be provided by the implementation of the traversal framework as a way for the user to describe traversals.
<code class="literal">TraversalDescription</code> instances are immutable and its methods returns a new <code class="literal">TraversalDescription</code> that is modified compared to the object the method was invoked on with the arguments of the method.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_relationships"></a>Relationships</h4></div></div></div><p>Adds a relationship type to the list of relationship types to traverse.
By default that list is empty and it means that it will traverse <span class="emphasis"><em>all relationships</em></span>, irregardless of type.
If one or more relationships are added to this list <span class="emphasis"><em>only the added</em></span> types will be traversed.
There are two methods, one <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#relationships" target="_top">including direction</a> and another one <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#relationships" target="_top">excluding direction</a>, where the latter traverses relationships in <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/Direction.html#BOTH" target="_top">both directions</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_evaluator"></a>33.2.2. Evaluator</h3></div></div></div><p><a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/Evaluator.html" target="_top"><code class="literal">Evaluator</code></a>s are used for deciding, at each position (represented as a <code class="literal">Path</code>): should the traversal continue, and/or should the node be included in the result.
Given a <code class="literal">Path</code>, it asks for one of four actions for that branch of the traversal:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">Evaluation.INCLUDE_AND_CONTINUE</code>: Include this node in the result and continue the traversal
</li><li class="listitem">
<code class="literal">Evaluation.INCLUDE_AND_PRUNE</code>: Include this node in the result, but don’t continue the traversal
</li><li class="listitem">
<code class="literal">Evaluation.EXCLUDE_AND_CONTINUE</code>: Exclude this node from the result, but continue the traversal
</li><li class="listitem">
<code class="literal">Evaluation.EXCLUDE_AND_PRUNE</code>: Exclude this node from the result and don’t continue the traversal
</li></ul></div><p>More than one evaluator can be added. Note that evaluators will be called for all positions the traverser encounters, even for the start node.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_traverser"></a>33.2.3. Traverser</h3></div></div></div><p>The <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/Traverser.html" target="_top"><code class="literal">Traverser</code></a> object is the result of invoking <a class="ulink" href="http://components.neo4j.org/neo4j-kernel/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#traverse(org.neo4j.graphdb.Node)" target="_top"><code class="literal">traverse()</code></a> of a TraversalDescription object.
It represents a traversal positioned in the graph, and a specification of the format of the result.
The actual traversal is performed lazily each time the <code class="literal">next()</code>-method of the iterator of the <code class="literal">Traverser</code> is invoked.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_uniqueness"></a>33.2.4. Uniqueness</h3></div></div></div><p>Sets the rules for how positions can be revisited during a traversal as stated in <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/kernel/Uniqueness.html" target="_top"><code class="literal">Uniqueness</code></a>.
Default if not set is <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/kernel/Uniqueness.html#NODE_GLOBAL" target="_top"><code class="literal">NODE_GLOBAL</code></a>.</p><p>A Uniqueness can be supplied to the TraversalDescription to dictate under what circumstances a traversal may revisit the same position in the graph. The various uniqueness levels that can be used in Neo4j are:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">NONE</code>: Any position in the graph may be revisited.
</li><li class="listitem">
<code class="literal">NODE_GLOBAL</code> uniqueness: No node in the entire graph may be visited more than once. This could potentially consume a lot of memory since it requires keeping an in-memory data structure remembering all the visited nodes.
</li><li class="listitem">
<code class="literal">RELATIONSHIP_GLOBAL</code> uniqueness: no relationship in the entire graph may be visited more than once. For the same reasons as <code class="literal">NODE_GLOBAL</code> uniqueness, this could use up a lot of memory. But since graphs typically have a larger number of relationships than nodes, the memory overhead of this uniqueness level could grow even quicker.
</li><li class="listitem">
<code class="literal">NODE_PATH</code> uniqueness: A node may not occur previously in the path reaching up to it.
</li><li class="listitem">
<code class="literal">RELATIONSHIP_PATH</code> uniqueness: A relationship may not occur previously in the path reaching up to it.
</li><li class="listitem">
<code class="literal">NODE_RECENT</code> uniqueness: Similar to <code class="literal">NODE_GLOBAL</code> uniqueness in that there is a global collection of visited nodes each position is checked against. This uniqueness level does however have a cap on how much memory it may consume in the form of a collection that only contains the most recently visited nodes. The size of this collection can be specified by providing a number as the second argument to the TraversalDescription.uniqueness()-method along with the uniqueness level.
</li><li class="listitem">
<code class="literal">RELATIONSHIP_RECENT</code> uniqueness: Works like <code class="literal">NODE_RECENT</code> uniqueness, but with relationships instead of nodes.
</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_depth_first_breadth_first"></a>Depth First / Breadth First</h4></div></div></div><p>These are convenience methods for setting preorder <a class="ulink" href="http://en.wikipedia.org/wiki/Depth-first_search" target="_top">depth-first</a>/ <a class="ulink" href="http://en.wikipedia.org/wiki/Breadth-first_search" target="_top">breadth-first</a> <code class="literal">BranchSelector</code>|<code class="literal">ordering</code> policies.
The same result can be achieved by calling the <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#order" target="_top"><code class="literal">order</code></a> method with ordering policies from the <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/kernel/Traversal.html#preorderDepthFirst" target="_top"><code class="literal">Traversal</code></a> <a class="ulink" href="http://components.neo4j.org/neo4j-kernel/2.0.0/apidocs/org/neo4j/kernel/Traversal.html#preorderBreadthFirst" target="_top"><code class="literal">factory</code></a>, or to write your own <code class="literal">BranchSelector</code>/<code class="literal">BranchOrderingPolicy</code> and pass in.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_order_8201_8212_8201_how_to_move_through_branches"></a>33.2.5. Order — How to move through branches?</h3></div></div></div><p>A more generic version of depthFirst/breadthFirst methods in that it allows an arbitrary <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/BranchOrderingPolicy.html" target="_top"><code class="literal">BranchOrderingPolicy</code></a> to be injected into the description.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_branchselector"></a>33.2.6. BranchSelector</h3></div></div></div><p>A BranchSelector is used for selecting which branch of the traversal to attempt next. This is used for implementing traversal orderings. The traversal framework provides a few basic ordering implementations:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">Traversal.preorderDepthFirst()</code>: Traversing depth first, visiting each node before visiting its child nodes.
</li><li class="listitem">
<code class="literal">Traversal.postorderDepthFirst()</code>: Traversing depth first, visiting each node after visiting its child nodes.
</li><li class="listitem">
<code class="literal">Traversal.preorderBreadthFirst()</code>: Traversing breadth first, visiting each node before visiting its child nodes.
</li><li class="listitem">
<code class="literal">Traversal.postorderBreadthFirst()</code>: Traversing breadth first, visiting each node after visiting its child nodes.
</li></ul></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that breadth first traversals have a higher memory overhead than depth first traversals.</p></td></tr></table></div><p>BranchSelectors carries state and hence needs to be uniquely instantiated for each traversal. Therefore it is supplied to the TraversalDescription through a BranchOrderingPolicy interface, which is a factory of BranchSelector instances.</p><p>A user of the Traversal framework rarely needs to implement his own BranchSelector or BranchOrderingPolicy, it is provided to let graph algorithm implementors provide their own traversal orders. The Neo4j Graph Algorithms package contains for example a BestFirst order BranchSelector/BranchOrderingPolicy that is used in BestFirst search algorithms such as A* and Dijkstra.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_branchorderingpolicy"></a>BranchOrderingPolicy</h4></div></div></div><p>A factory for creating BranchSelectors to decide in what order branches are returned (where a branch’s position is represented as a <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/Path.html" target="_top"><code class="literal">Path</code></a> from the start node to the current node). Common policies are <a class="ulink" href="http://components.neo4j.org/neo4j-kernel/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#depthFirst()" target="_top"><code class="literal">depth-first</code></a> and <a class="ulink" href="http://components.neo4j.org/neo4j-kernel/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#breadthFirst()" target="_top"><code class="literal">breadth-first</code></a> and that’s why there are convenience methods for those.
For example, calling <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#depthFirst()" target="_top"><code class="literal">TraversalDescription#depthFirst()</code></a> is equivalent to:</p><pre class="programlisting brush: java">description.order( Traversal.preorderDepthFirst() );</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_traversalbranch"></a>TraversalBranch</h4></div></div></div><p>An object used by the BranchSelector to get more branches from a certain branch. In essence these are a composite of a Path and a RelationshipExpander that can be used to get new <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalBranch.html" target="_top"><code class="literal">TraversalBranch</code></a>es from the current one.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_path"></a>33.2.7. Path</h3></div></div></div><p>A <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/Path.html" target="_top"><code class="literal">Path</code></a> is a general interface that is part of the Neo4j API.
In the traversal API of Neo4j the use of Paths are twofold.
Traversers can return their results in the form of the Paths of the visited positions in the graph that are marked for being returned.
Path objects are also used in the evaluation of positions in the graph, for determining if the traversal should continue from a certain point or not, and whether a certain position should be included in the result set or not.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_pathexpander_relationshipexpander"></a>33.2.8. PathExpander/RelationshipExpander</h3></div></div></div><p>The traversal framework use PathExpanders (replacing RelationshipExpander) to discover the relationships that should be followed from a particular path to further branches in the traversal.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_expander"></a>33.2.9. Expander</h3></div></div></div><p>A more generic version of relationships where a <code class="literal">RelationshipExpander</code> is injected, defining all relationships to be traversed for any given node. By default (and when using relationships) a <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/kernel/Traversal.html#emptyExpander" target="_top">default expander</a> is used, where any particular order of relationships isn’t guaranteed.
There’s another implementation which guarantees that relationships are traversed in <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/kernel/OrderedByTypeExpander.html" target="_top">order of relationship type</a>, where types are iterated in the order they were added.</p><p>The <code class="literal">Expander</code> interface is an extension of the <code class="literal">RelationshipExpander</code> interface that makes it possible to build customized versions of an <code class="literal">Expander</code>.
The implementation of <code class="literal">TraversalDescription</code> uses this to provide methods for defining which relationship types to traverse, this is the usual way a user of the API would define a <code class="literal">RelationshipExpander</code> — by building it internally in the <code class="literal">TraversalDescription</code>.</p><p>All the RelationshipExpanders provided by the Neo4j traversal framework also implement the Expander interface.
For a user of the traversal API it is easier to implement the PathExpander/RelationshipExpander interface, since it only contains one method — the method for getting the relationships from a path/node, the methods that the Expander interface adds are just for building new Expanders.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="examples-how-to-use-the-traversal-framework"></a>33.2.10. How to use the Traversal framework</h3></div></div></div><p>A
<a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html" target="_top">traversal description</a> is built using a
fluent interface and such a description can then spawn
<a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/Traverser.html" target="_top">traversers</a>.</p><div class="figure"><a id="idp20065248"></a><p class="title"><strong>Figure 33.1. Traversal Example Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Traversal-Example-Graph-how-to-use-the-Traversal-framework.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Traversal-Example-Graph-how-to-use-the-Traversal-framework.svg" alt="Traversal-Example-Graph-how-to-use-the-Traversal-framework.svg" /></span>
</a></div></div><br class="figure-break" /><p>With the definition of the <code class="literal">RelationshipTypes</code> as</p><pre class="programlisting brush: java">private enum Rels implements RelationshipType
{
    LIKES, KNOWS
}
</pre><p>The graph can be traversed with for example the following traverser, starting at the “Joe” node:</p><pre class="programlisting brush: java">for ( Path position : Traversal.description()
        .depthFirst()
        .relationships( Rels.KNOWS )
        .relationships( Rels.LIKES, Direction.INCOMING )
        .evaluator( Evaluators.toDepth( 5 ) )
        .traverse( node ) )
{
    output += position + "\n";
}
</pre><p>The traversal will output:</p><pre class="programlisting brush: plain">(6)
(6)&lt;--[LIKES,1]--(3)
(6)&lt;--[LIKES,1]--(3)--[KNOWS,6]--&gt;(0)
(6)&lt;--[LIKES,1]--(3)--[KNOWS,6]--&gt;(0)--[KNOWS,4]--&gt;(5)
(6)&lt;--[LIKES,1]--(3)--[KNOWS,6]--&gt;(0)--[KNOWS,4]--&gt;(5)--[KNOWS,3]--&gt;(4)
(6)&lt;--[LIKES,1]--(3)--[KNOWS,6]--&gt;(0)--[KNOWS,4]--&gt;(5)--[KNOWS,3]--&gt;(4)--[KNOWS,2]--&gt;(1)
(6)&lt;--[LIKES,1]--(3)--[KNOWS,6]--&gt;(0)&lt;--[KNOWS,5]--(2)</pre><p>Since <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html" target="_top"><code class="literal">TraversalDescription</code></a>s
are immutable it is also useful to create template descriptions which holds common
settings shared by different traversals. For example, let’s start with this traverser:</p><pre class="programlisting brush: java">final TraversalDescription FRIENDS_TRAVERSAL = Traversal.description()
        .depthFirst()
        .relationships( Rels.KNOWS )
        .uniqueness( Uniqueness.RELATIONSHIP_GLOBAL );
</pre><p>This traverser would yield the following output (we will keep starting from the “Joe” node):</p><pre class="programlisting brush: plain">(6)
(6)--[KNOWS,0]--&gt;(1)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)&lt;--[KNOWS,3]--(5)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)&lt;--[KNOWS,3]--(5)&lt;--[KNOWS,4]--(0)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)&lt;--[KNOWS,3]--(5)&lt;--[KNOWS,4]--(0)&lt;--[KNOWS,5]--(2)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)&lt;--[KNOWS,3]--(5)&lt;--[KNOWS,4]--(0)&lt;--[KNOWS,6]--(3)</pre><p>Now let’s create a new traverser from it, restricting depth to three:</p><pre class="programlisting brush: java">for ( Path path : FRIENDS_TRAVERSAL
        .evaluator( Evaluators.toDepth( 3 ) )
        .traverse( node ) )
{
    output += path + "\n";
}
</pre><p>This will give us the following result:</p><pre class="programlisting brush: plain">(6)
(6)--[KNOWS,0]--&gt;(1)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)&lt;--[KNOWS,3]--(5)</pre><p>Or how about from depth two to four?
That’s done like this:</p><pre class="programlisting brush: java">for ( Path path : FRIENDS_TRAVERSAL
        .evaluator( Evaluators.fromDepth( 2 ) )
        .evaluator( Evaluators.toDepth( 4 ) )
        .traverse( node ) )
{
    output += path + "\n";
}
</pre><p>This traversal gives us:</p><pre class="programlisting brush: plain">(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)&lt;--[KNOWS,3]--(5)
(6)--[KNOWS,0]--&gt;(1)&lt;--[KNOWS,2]--(4)&lt;--[KNOWS,3]--(5)&lt;--[KNOWS,4]--(0)</pre><p>For various useful evaluators, see the
<a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/Evaluators.html" target="_top">Evaluators</a> Java API
or simply implement the
<a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/Evaluator.html" target="_top">Evaluator</a> interface yourself.</p><p>If you’re not interested in the <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/Path.html" target="_top"><code class="literal">Path</code></a>s,
but the <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/Node.html" target="_top"><code class="literal">Node</code></a>s
you can transform the traverser into an iterable of <a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/Traverser.html#nodes()" target="_top">nodes</a>
like this:</p><pre class="programlisting brush: java">for ( Node currentNode : FRIENDS_TRAVERSAL
        .traverse( node )
        .nodes() )
{
    output += currentNode.getProperty( "name" ) + "\n";
}
</pre><p>In this case we use it to retrieve the names:</p><pre class="programlisting brush: plain">Joe
Sara
Peter
Dirk
Lars
Ed
Lisa</pre><p><a class="ulink" href="http://components.neo4j.org/neo4j/2.0.0/apidocs/org/neo4j/graphdb/traversal/Traverser.html#relationships()" target="_top">Relationships</a>
are fine as well, here’s how to get them:</p><pre class="programlisting brush: java">for ( Relationship relationship : FRIENDS_TRAVERSAL
        .traverse( node )
        .relationships() )
{
    output += relationship.getType() + "\n";
}
</pre><p>Here the relationship types are written, and we get:</p><pre class="programlisting brush: plain">RelationshipTypeToken[name:KNOWS, id:0]
RelationshipTypeToken[name:KNOWS, id:0]
RelationshipTypeToken[name:KNOWS, id:0]
RelationshipTypeToken[name:KNOWS, id:0]
RelationshipTypeToken[name:KNOWS, id:0]
RelationshipTypeToken[name:KNOWS, id:0]</pre><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png" /></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The source code for the traversers in this example is available at:
<a class="ulink" href="https://github.com/neo4j/neo4j/blob/2.0.0/community/embedded-examples/src/main/java/org/neo4j/examples/TraversalExample.java" target="_top">TraversalExample.java</a></p></td></tr></table></div></div></div><HR xmlns=""></HR><a xmlns="" href="ln-idp218960.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2013 Neo Technology</p></a><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tutorial-traversal-concepts.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="tutorial-traversal.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="indexing.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>
