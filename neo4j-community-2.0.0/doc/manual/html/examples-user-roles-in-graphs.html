<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.18. User roles in graphs</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="The Neo4j Manual v2.0.0" /><link rel="up" href="data-modeling-examples.html" title="Chapter 5. Data Modeling Examples" /><link rel="prev" href="cypher-cookbook-graphity.html" title="5.17. The Graphity activity stream model" /><link rel="next" href="languages.html" title="Chapter 6. Languages" /><link rel="preface" href="preface.html" title="Preface" /><link rel="part" href="introduction.html" title="Part I. Introduction" /><link rel="chapter" href="introduction-highlights.html" title="Chapter 1. Neo4j Highlights" /><link rel="chapter" href="graphdb-concepts.html" title="Chapter 2. Graph Database Concepts" /><link rel="chapter" href="graphdb-neo4j.html" title="Chapter 3. The Neo4j Graph Database" /><link rel="part" href="tutorials.html" title="Part II. Tutorials" /><link rel="chapter" href="tutorials-cypher.html" title="Chapter 4. Getting started with Cypher" /><link rel="chapter" href="data-modeling-examples.html" title="Chapter 5. Data Modeling Examples" /><link rel="chapter" href="languages.html" title="Chapter 6. Languages" /><link rel="part" href="cypher-query-lang.html" title="Part III. Cypher Query Language" /><link rel="chapter" href="cypher-intro.html" title="Chapter 7. Introduction" /><link rel="chapter" href="query-syntax.html" title="Chapter 8. Syntax" /><link rel="chapter" href="query-general.html" title="Chapter 9. General Clauses" /><link rel="chapter" href="query-read.html" title="Chapter 10. Reading Clauses" /><link rel="chapter" href="query-write.html" title="Chapter 11. Writing Clauses" /><link rel="chapter" href="query-function.html" title="Chapter 12. Functions" /><link rel="chapter" href="cypher-schema.html" title="Chapter 13. Schema" /><link rel="chapter" href="examples-from-sql-to-cypher.html" title="Chapter 14. From SQL to Cypher" /><link rel="part" href="reference-documentation.html" title="Part IV. Reference" /><link rel="chapter" href="capabilities.html" title="Chapter 15. Capabilities" /><link rel="chapter" href="transactions.html" title="Chapter 16. Transaction Management" /><link rel="chapter" href="import.html" title="Chapter 17. Data Import" /><link rel="chapter" href="graph-algo.html" title="Chapter 18. Graph Algorithms" /><link rel="chapter" href="rest-api.html" title="Chapter 19. REST API" /><link rel="chapter" href="deprecations.html" title="Chapter 20. Deprecations" /><link rel="part" href="operations.html" title="Part V. Operations" /><link rel="chapter" href="deployment.html" title="Chapter 21. Installation &amp; Deployment" /><link rel="chapter" href="embedded-configuration.html" title="Chapter 22. Configuration &amp; Performance" /><link rel="chapter" href="ha.html" title="Chapter 23. High Availability" /><link rel="chapter" href="operations-backup.html" title="Chapter 24. Backup" /><link rel="chapter" href="operations-security.html" title="Chapter 25. Security" /><link rel="chapter" href="operations-monitoring.html" title="Chapter 26. Monitoring" /><link rel="part" href="tools.html" title="Part VI. Tools" /><link rel="chapter" href="tools-webadmin.html" title="Chapter 27. Web Interface" /><link rel="chapter" href="shell.html" title="Chapter 28. Neo4j Shell" /><link rel="part" href="community.html" title="Part VII. Community" /><link rel="chapter" href="community-support.html" title="Chapter 29. Community Support" /><link rel="chapter" href="community-contributing.html" title="Chapter 30. Contributing to Neo4j" /><link rel="part" href="advanced-usage.html" title="Part VIII. Advanced Usage" /><link rel="chapter" href="server-extending.html" title="Chapter 31. Extending the Neo4j Server" /><link rel="chapter" href="tutorials-java-embedded.html" title="Chapter 32. Using Neo4j embedded in Java applications" /><link rel="chapter" href="tutorial-traversal.html" title="Chapter 33. The Traversal Framework" /><link rel="chapter" href="indexing.html" title="Chapter 34. Legacy Indexing" /><link rel="chapter" href="batchinsert.html" title="Chapter 35. Batch Insertion" /><link rel="appendix" href="manpages.html" title="Appendix A. Manpages" /><link rel="refentry" href="re01.html" title="neo4j" /><link rel="refentry" href="re02.html" title="neo4j-installer" /><link rel="refentry" href="re03.html" title="neo4j-shell" /><link rel="refentry" href="re04.html" title="neo4j-backup" /><link rel="refentry" href="re05.html" title="neo4j-arbiter" /><link rel="subsection" href="examples-user-roles-in-graphs.html#_get_the_admins" title="5.18.1. Get the admins" /><link rel="subsection" href="examples-user-roles-in-graphs.html#_get_the_group_memberships_of_a_user" title="5.18.2. Get the group memberships of a user" /><link rel="subsection" href="examples-user-roles-in-graphs.html#_get_all_groups" title="5.18.3. Get all groups" /><link rel="subsection" href="examples-user-roles-in-graphs.html#_get_all_members_of_all_groups" title="5.18.4. Get all members of all groups" /><link rel="copyright" href="ln-idp218960.html" title="License: Creative Commons 3.0" />


<!-- favicon -->

<link rel="shortcut icon" href="http://neo4j.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://neo4j.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/neo.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushCypher.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushProperties.js"></script>

<!-- activate when needed
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
-->
 
<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Replace SVG for browsers that lack support. -->
<script type="text/javascript" src="js/svgreplacer.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Version -->

<script type="text/javascript" src="js/version.js"></script>

<!-- Offline Sidebar -->

<script type="text/javascript" src="js/sidebar.js"></script>


<div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">The Neo4j Manual</a></span> &gt; <span class="breadcrumb-link"><a href="tutorials.html">Tutorials</a></span> &gt; <span class="breadcrumb-link"><a href="data-modeling-examples.html">Data Modeling Examples</a></span> &gt; <span class="breadcrumb-node">User roles in graphs</span></div></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="cypher-cookbook-graphity.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="languages.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="examples-user-roles-in-graphs"></a>5.18. User roles in graphs</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="examples-user-roles-in-graphs.html#_get_the_admins">5.18.1. Get the admins</a></span></dt><dt><span class="section"><a href="examples-user-roles-in-graphs.html#_get_the_group_memberships_of_a_user">5.18.2. Get the group memberships of a user</a></span></dt><dt><span class="section"><a href="examples-user-roles-in-graphs.html#_get_all_groups">5.18.3. Get all groups</a></span></dt><dt><span class="section"><a href="examples-user-roles-in-graphs.html#_get_all_members_of_all_groups">5.18.4. Get all members of all groups</a></span></dt></dl></div><p>This is an example showing a hierarchy of
roles.
What’s interesting is that a tree is not sufficient for storing this kind of structure,
as elaborated below.</p><div class="informalfigure"><a class="ulink" href="images/roles.png" target="_top">
<span class="inlinemediaobject"><img src="images/roles.png" width="100%" alt="roles.png" /></span>
</a></div><p>This is an implementation of an example found in the article
<a class="ulink" href="http://www.codeproject.com/Articles/22824/A-Model-to-Represent-Directed-Acyclic-Graphs-DAG-o" target="_top">A Model to Represent Directed Acyclic Graphs (DAG) on SQL Databases</a>
by <a class="ulink" href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=274518" target="_top">Kemal Erdogan</a>.
The article discusses how to store <a class="ulink" href="http://en.wikipedia.org/wiki/Directed_acyclic_graph" target="_top">
directed acyclic graphs</a> (DAGs)
in SQL based DBs. DAGs are almost trees, but with a twist: it may be possible to reach
the same node through different paths. Trees are restricted from this possibility, which
makes them much easier to handle. In our case it is “Ali” and “Engin”,
as they are both admins and users and thus reachable through these group nodes.
Reality often looks this way and can’t be captured by tree structures.</p><p>In the article an SQL Stored Procedure solution is provided. The main idea,
that also have some support from scientists, is to pre-calculate all possible (transitive) paths.
Pros and cons of this approach:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
decent performance on read
</li><li class="listitem">
low performance on insert
</li><li class="listitem">
wastes <span class="emphasis"><em>lots</em></span> of space
</li><li class="listitem">
relies on stored procedures
</li></ul></div><p>In Neo4j storing the roles is trivial. In this case we use <code class="literal">PART_OF</code> (green edges) relationships
to model the group hierarchy and <code class="literal">MEMBER_OF</code> (blue edges) to model membership in groups.
We also connect the top level groups to the reference node by <code class="literal">ROOT</code> relationships.
This gives us a useful partitioning of the graph. Neo4j has no predefined relationship
types, you are free to create any relationship types and give them the semantics you want.</p><p>Lets now have a look at how to retrieve information from the graph. The the queries are done using <a class="link" href="cypher-query-lang.html" title="Part III. Cypher Query Language">Cypher</a>,
the Java code is using the Neo4j Traversal API (see <a class="xref" href="tutorial-traversal-java-api.html" title="33.2. Traversal Framework Java API">Section 33.2, “Traversal Framework Java API”</a>, which is part of <a class="xref" href="advanced-usage.html" title="Part VIII. Advanced Usage">Part VIII, “Advanced Usage”</a>).</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_get_the_admins"></a>5.18.1. Get the admins</h3></div></div></div><p>In Cypher, we could get the admins like this:</p><pre class="programlisting brush: cypher">MATCH ({ name: 'Admins' })&lt;-[:PART_OF*0..]-(group)&lt;-[:MEMBER_OF]-(user)
RETURN user.name, group.name</pre><p>resulting in:</p><div class="queryresult table"><table cellspacing="0" cellpadding="0" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><thead><tr><th align="left" valign="top">user.name</th><th align="left" valign="top">group.name</th></tr></thead><tfoot><tr><th colspan="2" align="left" valign="top">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Demet"</code></p></td><td align="left" valign="top"><p><code class="literal">"HelpDesk"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Ali"</code></p></td><td align="left" valign="top"><p><code class="literal">"Admins"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Engin"</code></p></td><td align="left" valign="top"><p><code class="literal">"HelpDesk"</code></p></td></tr></tbody></table></div><p>And here’s the code when using the Java Traversal API:</p><pre class="programlisting brush: java">Node admins = getNodeByName( "Admins" );
TraversalDescription traversalDescription = db.traversalDescription()
        .breadthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.PART_OF, Direction.INCOMING )
        .relationships( RoleRels.MEMBER_OF, Direction.INCOMING );
Traverser traverser = traversalDescription.traverse( admins );
</pre><p>resulting in the output</p><pre class="programlisting brush: plain">Found: HelpDesk at depth: 0
Found: Ali at depth: 0
Found: Engin at depth: 1
Found: Demet at depth: 1</pre><p>The result is collected from the traverser using this code:</p><pre class="programlisting brush: java">String output = "";
for ( Path path : traverser )
{
    Node node = path.endNode();
    output += "Found: " + node.getProperty( NAME ) + " at depth: "
              + ( path.length() - 1 ) + "\n";
}
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_get_the_group_memberships_of_a_user"></a>5.18.2. Get the group memberships of a user</h3></div></div></div><p>In Cypher:</p><pre class="programlisting brush: cypher">MATCH ({ name: 'Jale' })-[:MEMBER_OF]-&gt;()-[:PART_OF*0..]-&gt;(group)
RETURN group.name</pre><div class="queryresult table"><table cellspacing="0" cellpadding="0" border="1"><colgroup><col class="col1" /></colgroup><thead><tr><th align="left" valign="top">group.name</th></tr></thead><tfoot><tr><th align="left" valign="top">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"ABCTechnicians"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Technicians"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Users"</code></p></td></tr></tbody></table></div><p>Using the Neo4j Java Traversal API, this query looks like:</p><pre class="programlisting brush: java">Node jale = getNodeByName( "Jale" );
traversalDescription = db.traversalDescription()
        .depthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.MEMBER_OF, Direction.OUTGOING )
        .relationships( RoleRels.PART_OF, Direction.OUTGOING );
traverser = traversalDescription.traverse( jale );
</pre><p>resulting in:</p><pre class="programlisting brush: plain">Found: ABCTechnicians at depth: 0
Found: Technicians at depth: 1
Found: Users at depth: 2</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_get_all_groups"></a>5.18.3. Get all groups</h3></div></div></div><p>In Cypher:</p><pre class="programlisting brush: cypher">MATCH ({ name: 'Reference_Node' })&lt;-[:ROOT]-&gt;()&lt;-[:PART_OF*0..]-(group)
RETURN group.name</pre><div class="queryresult table"><table cellspacing="0" cellpadding="0" border="1"><colgroup><col class="col1" /></colgroup><thead><tr><th align="left" valign="top">group.name</th></tr></thead><tfoot><tr><th align="left" valign="top">6 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Users"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"ABCTechnicians"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Managers"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"HelpDesk"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Technicians"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Admins"</code></p></td></tr></tbody></table></div><p>In Java:</p><pre class="programlisting brush: java">Node referenceNode = getNodeByName( "Reference_Node") ;
traversalDescription = db.traversalDescription()
        .breadthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.ROOT, Direction.INCOMING )
        .relationships( RoleRels.PART_OF, Direction.INCOMING );
traverser = traversalDescription.traverse( referenceNode );
</pre><p>resulting in:</p><pre class="programlisting brush: plain">Found: Admins at depth: 0
Found: Users at depth: 0
Found: HelpDesk at depth: 1
Found: Managers at depth: 1
Found: Technicians at depth: 1
Found: ABCTechnicians at depth: 2</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_get_all_members_of_all_groups"></a>5.18.4. Get all members of all groups</h3></div></div></div><p>Now, let’s try to find all users in the system being part of any group.</p><p>In Cypher, this looks like:</p><pre class="programlisting brush: cypher">MATCH ({ name: 'Reference_Node' })&lt;-[:ROOT]-&gt;(root), p=(root)&lt;-[PART_OF*0..]-()&lt;-[:MEMBER_OF]-(user)
RETURN user.name, min(length(p))
ORDER BY min(length(p)), user.name</pre><p>and results in the following output:</p><div class="queryresult table"><table cellspacing="0" cellpadding="0" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><thead><tr><th align="left" valign="top">user.name</th><th align="left" valign="top">min(length(p))</th></tr></thead><tfoot><tr><th colspan="2" align="left" valign="top">10 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Ali"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Burcu"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Can"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Engin"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Demet"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Fuat"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Gul"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Hakan"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Irmak"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Jale"</code></p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div><p>in Java:</p><pre class="programlisting brush: java">traversalDescription = db.traversalDescription()
        .breadthFirst()
        .evaluator(
                Evaluators.includeWhereLastRelationshipTypeIs( RoleRels.MEMBER_OF ) );
traverser = traversalDescription.traverse( referenceNode );
</pre><pre class="programlisting brush: plain">Found: Ali at depth: 1
Found: Engin at depth: 1
Found: Burcu at depth: 1
Found: Can at depth: 1
Found: Demet at depth: 2
Found: Gul at depth: 2
Found: Fuat at depth: 2
Found: Hakan at depth: 2
Found: Irmak at depth: 2
Found: Jale at depth: 3</pre><p>As seen above, querying even more complex scenarios can be done using comparatively short
constructs in Cypher or Java.</p></div></div><HR xmlns=""></HR><a xmlns="" href="ln-idp218960.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2013 Neo Technology</p></a><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cypher-cookbook-graphity.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="data-modeling-examples.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="languages.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>
